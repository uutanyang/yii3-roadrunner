# ============================================================
# Yii3 + RoadRunner Docker Compose 开发环境配置
# ============================================================
# 使用方法: docker-compose up -d (默认使用 .env 文件)
# 或者: docker-compose --env-file .env up -d

# ============================================================
# Docker Compose 通用配置
# ============================================================
# Compose 项目名称 (用于隔离不同项目)
COMPOSE_PROJECT_NAME=yii3-dev

# Docker Compose 文件版本
COMPOSE_FILE=docker-compose.yml

# 容器重启策略: 开发环境使用 on-failure
# on-failure[:max-retries] - 失败时重启
RESTART_POLICY=on-failure

# 日志配置
LOG_DRIVER=json-file
LOG_MAX_SIZE=50m
LOG_MAX_FILE=5

# ============================================================
# 应用配置
# ============================================================
# 应用环境: development
APP_ENV=development

# 是否启用调试模式 (开发环境开启)
APP_DEBUG=true

# 应用 HTTP 端口 (映射到宿主机)
# 开发环境常用端口: 8080, 3000, 8000
APP_HTTP_PORT=8080

# 应用容器名称
APP_CONTAINER_NAME=yii3-app-dev

# ============================================================
# PostgreSQL 数据库配置
# ============================================================
# 数据库镜像版本
POSTGRES_IMAGE=postgres:15-alpine

# 数据库容器名称
POSTGRES_CONTAINER_NAME=yii3-postgres-dev

# 数据库服务主机 (容器内部使用)
DB_HOST=postgres

# 数据库端口 (映射到宿主机)
DB_PORT=5432

# 数据库名称
DB_NAME=yii3_dev

# 数据库用户名
DB_USER=yii3

# 数据库密码 (开发环境可以使用简单密码)
DB_PASSWORD=dev_password_123

# PostgreSQL 数据目录 (使用本地目录便于数据备份)
POSTGRES_DATA_VOLUME=./data/postgres

# PostgreSQL 最大连接数 (开发环境可以设置小一些)
POSTGRES_MAX_CONNECTIONS=100

# PostgreSQL 共享缓冲区大小 (开发环境可以设置小一些)
POSTGRES_SHARED_BUFFERS=128MB

# PostgreSQL 有效缓存大小
POSTGRES_EFFECTIVE_CACHE_SIZE=512MB

# 启用慢查询日志 (调试用)
POSTGRES_LOG_MIN_DURATION_STATEMENT=1000

# ============================================================
# Redis 缓存配置
# ============================================================
# Redis 镜像版本
REDIS_IMAGE=redis:7-alpine

# Redis 容器名称
REDIS_CONTAINER_NAME=yii3-redis-dev

# Redis 服务主机 (容器内部使用)
REDIS_HOST=redis

# Redis 端口 (映射到宿主机)
REDIS_PORT=6379

# Redis 密码 (开发环境可以不设置密码)
REDIS_PASSWORD=

# Redis 数据库编号 (0-15)
REDIS_DB=0

# Redis 数据目录 (使用本地目录)
REDIS_DATA_VOLUME=./data/redis

# Redis 最大内存限制 (开发环境可以设置小一些)
REDIS_MAX_MEMORY=256mb

# Redis 内存淘汰策略
REDIS_MAXMEMORY_POLICY=allkeys-lru

# 启用 AOF 持久化
REDIS_APPENDONLY=yes

# ============================================================
# MinIO 对象存储配置
# ============================================================
# MinIO 镜像版本
MINIO_IMAGE=minio/minio:latest

# MinIO 容器名称
MINIO_CONTAINER_NAME=yii3-minio-dev

# MinIO 服务端点 (容器内部使用)
MINIO_ENDPOINT=minio:9000

# MinIO 访问密钥 (开发环境使用默认值)
MINIO_ACCESS_KEY=minioadmin

# MinIO 密钥 (开发环境使用默认值)
MINIO_SECRET_KEY=minioadmin

# MinIO API 端口 (映射到宿主机)
MINIO_API_PORT=9000

# MinIO Web 控制台端口 (映射到宿主机)
MINIO_CONSOLE_PORT=9001

# MinIO 存储桶名称
MINIO_BUCKET=yii3-uploads-dev

# MinIO 数据目录 (使用本地目录)
MINIO_DATA_VOLUME=./data/minio

# 是否使用 SSL (开发环境不使用)
MINIO_USE_SSL=false

# MinIO 区域代码
MINIO_REGION=us-east-1

# MinIO 服务器 URL
MINIO_SERVER_URL=http://localhost:9000

# MinIO 控制台 URL
MINIO_CONSOLE_URL=http://localhost:9001

# ============================================================
# NATS 消息队列配置
# ============================================================
# NATS 镜像版本
NATS_IMAGE=nats:2.10-alpine

# NATS 容器名称
NATS_CONTAINER_NAME=yii3-nats-dev

# NATS 连接地址 (容器内部使用)
NATS_URL=nats://nats:4222

# NATS 端口配置 (映射到宿主机)
NATS_PORT=4222
NATS_MONITORING_PORT=8222
NATS_WEBSOCKET_PORT=6222

# NATS 数据目录 (使用本地目录)
NATS_DATA_VOLUME=./data/nats

# NATS JetStream Stream 名称
NATS_STREAM_NAME=yii3-stream-dev

# NATS JetStream Consumer 名称
NATS_CONSUMER_NAME=yii3-consumer-dev

# 是否启用 NATS 认证 (开发环境不启用)
NATS_ENABLE_AUTH=false

# NATS 用户名
NATS_USER=

# NATS 密码
NATS_PASSWORD=

# NATS 最大负载大小
NATS_MAX_PAYLOAD=1048576

# NATS 最大连接数
NATS_MAX_CONNECTIONS=65536

# ============================================================
# Docker 资源限制配置
# ============================================================
# 开发环境可以适当降低资源限制
APP_MEMORY_LIMIT=256m
APP_CPU_LIMIT=0.5
APP_MEMORY_RESERVATION=128m
APP_CPU_RESERVATION=0.25

POSTGRES_MEMORY_LIMIT=512m
POSTGRES_CPU_LIMIT=0.5
POSTGRES_MEMORY_RESERVATION=256m
POSTGRES_CPU_RESERVATION=0.25

REDIS_MEMORY_LIMIT=256m
REDIS_CPU_LIMIT=0.25
REDIS_MEMORY_RESERVATION=128m
REDIS_CPU_RESERVATION=0.1

MINIO_MEMORY_LIMIT=512m
MINIO_CPU_LIMIT=0.5
MINIO_MEMORY_RESERVATION=256m
MINIO_CPU_RESERVATION=0.25

NATS_MEMORY_LIMIT=256m
NATS_CPU_LIMIT=0.25
NATS_MEMORY_RESERVATION=128m
NATS_CPU_RESERVATION=0.1

# ============================================================
# 网络配置
# ============================================================
NETWORK_NAME=yii3-dev-network
NETWORK_DRIVER=bridge

# ============================================================
# 健康检查配置
# ============================================================
# 开发环境可以缩短检查间隔
HEALTHCHECK_INTERVAL=15
HEALTHCHECK_TIMEOUT=5
HEALTHCHECK_RETRIES=3
HEALTHCHECK_START_PERIOD=5

# ============================================================
# 时区和地区配置
# ============================================================
TZ=Asia/Shanghai
LANG=en_US.UTF-8
LC_ALL=en_US.UTF-8

# ============================================================
# 开发环境特有配置
# ============================================================
# 是否启用 Xdebug 调试
ENABLE_XDEBUG=false

# 是否启用性能分析
ENABLE_PROFILER=false

# 是否启用热重载
ENABLE_HOT_RELOAD=true

# 是否显示详细日志
VERBOSE_LOGGING=true
