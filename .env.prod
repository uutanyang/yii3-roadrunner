# ============================================================
# Yii3 + RoadRunner Docker Compose 生产环境配置
# ============================================================
# 使用方法: docker-compose --env-file .env.prod up -d

# ============================================================
# Docker Compose 通用配置
# ============================================================
# Compose 项目名称 (用于隔离不同项目)
# 默认值: 当前目录名
COMPOSE_PROJECT_NAME=yii3-production

# Docker Compose 文件版本
COMPOSE_FILE=docker-compose.yml

# 容器重启策略: no, on-failure, always, unless-stopped
# no - 不自动重启
# on-failure[:max-retries] - 失败时重启
# always - 总是重启
# unless-stopped - 除非手动停止，否则总是重启
RESTART_POLICY=unless-stopped

# 日志配置
# 日志驱动: json-file, syslog, journald, gelf, fluentd, awslogs, splunk, etwlogs, gcplogs
LOG_DRIVER=json-file

# 日志最大大小 (例如: 10m, 100m, 1g)
LOG_MAX_SIZE=100m

# 日志保留数量
LOG_MAX_FILE=10

# ============================================================
# 应用配置
# ============================================================
# 应用环境: production, development, testing
APP_ENV=production

# 是否启用调试模式 (建议生产环境关闭)
APP_DEBUG=false

# 应用 HTTP 端口 (映射到宿主机)
# 如果端口冲突，请修改此值
APP_HTTP_PORT=8080

# 应用容器名称
APP_CONTAINER_NAME=yii3-app

# ============================================================
# PostgreSQL 数据库配置
# ============================================================
# 数据库镜像版本
POSTGRES_IMAGE=postgres:15-alpine

# 数据库容器名称
POSTGRES_CONTAINER_NAME=yii3-postgres

# 数据库服务主机 (容器内部使用，通常不需要修改)
DB_HOST=postgres

# 数据库端口 (映射到宿主机)
# 如果端口冲突，请修改此值
DB_PORT=5432

# 数据库名称
DB_NAME=yii3

# 数据库用户名
DB_USER=yii3

# 数据库密码 (必须设置强密码)
# 请修改为强密码，至少 16 位，包含大小写字母、数字和特殊字符
DB_PASSWORD=your_strong_database_password_here

# PostgreSQL 数据目录 (Docker volume)
# 默认使用命名卷，也可以指定主机路径: ./data/postgres:/var/lib/postgresql/data
POSTGRES_DATA_VOLUME=yii3-postgres-data

# PostgreSQL 最大连接数
POSTGRES_MAX_CONNECTIONS=200

# PostgreSQL 共享缓冲区大小 (建议: 系统内存的 25%)
POSTGRES_SHARED_BUFFERS=256MB

# PostgreSQL 有效缓存大小 (建议: 系统内存的 50-75%)
POSTGRES_EFFECTIVE_CACHE_SIZE=1GB

# 是否启用慢查询日志
POSTGRES_LOG_MIN_DURATION_STATEMENT=-1

# ============================================================
# Redis 缓存配置
# ============================================================
# Redis 镜像版本
REDIS_IMAGE=redis:7-alpine

# Redis 容器名称
REDIS_CONTAINER_NAME=yii3-redis

# Redis 服务主机 (容器内部使用，通常不需要修改)
REDIS_HOST=redis

# Redis 端口 (映射到宿主机)
# 如果端口冲突，请修改此值
REDIS_PORT=6379

# Redis 密码 (留空表示不设置密码)
# 注意: 生产环境建议设置密码
REDIS_PASSWORD=

# Redis 数据库编号 (0-15)
REDIS_DB=0

# Redis 数据目录 (Docker volume)
REDIS_DATA_VOLUME=yii3-redis-data

# Redis 最大内存限制 (例如: 512mb, 1gb)
# 建议: 设置为可用内存的 50-70%
REDIS_MAX_MEMORY=512mb

# Redis 内存淘汰策略:
# noeviction - 不删除任何键，返回错误
# allkeys-lru - 删除最少使用的键
# volatile-lru - 在设置了过期时间的键中删除最少使用的
# allkeys-random - 随机删除键
# volatile-random - 在设置了过期时间的键中随机删除
# volatile-ttl - 删除即将过期的键
REDIS_MAXMEMORY_POLICY=allkeys-lru

# 是否启用 AOF 持久化 (true/false)
REDIS_APPENDONLY=yes

# Redis 持久化文件名
REDIS_APPEND_FILENAME=appendonly.aof

# ============================================================
# MinIO 对象存储配置
# ============================================================
# MinIO 镜像版本
MINIO_IMAGE=minio/minio:latest

# MinIO 容器名称
MINIO_CONTAINER_NAME=yii3-minio

# MinIO 服务端点 (容器内部使用，通常不需要修改)
MINIO_ENDPOINT=minio:9000

# MinIO 访问密钥 (管理员用户名)
# 默认: minioadmin
# 生产环境请务必修改为强密码
MINIO_ACCESS_KEY=minioadmin

# MinIO 密钥 (管理员密码)
# 默认: minioadmin
# 生产环境请务必修改为强密码
MINIO_SECRET_KEY=minioadmin

# MinIO API 端口 (映射到宿主机)
# 如果端口冲突，请修改此值
MINIO_API_PORT=9000

# MinIO Web 控制台端口 (映射到宿主机)
# 如果端口冲突，请修改此值
MINIO_CONSOLE_PORT=9001

# MinIO 存储桶名称 (自动创建)
MINIO_BUCKET=yii3-uploads

# MinIO 数据目录 (Docker volume)
MINIO_DATA_VOLUME=yii3-minio-data

# 是否使用 SSL 连接 MinIO
MINIO_USE_SSL=false

# MinIO 区域代码 (例如: us-east-1, cn-north-1)
MINIO_REGION=us-east-1

# MinIO 服务器 URL (用于外部访问)
# 如果使用反向代理，请修改为你的域名
MINIO_SERVER_URL=http://localhost:9000

# MinIO 控制台 URL
MINIO_CONSOLE_URL=http://localhost:9001

# ============================================================
# NATS 消息队列配置
# ============================================================
# NATS 镜像版本
NATS_IMAGE=nats:2.10-alpine

# NATS 容器名称
NATS_CONTAINER_NAME=yii3-nats

# NATS 连接地址 (容器内部使用，通常不需要修改)
NATS_URL=nats://nats:4222

# NATS 端口配置 (映射到宿主机)
# 如果端口冲突，请修改这些值
NATS_PORT=4222
NATS_MONITORING_PORT=8222
NATS_WEBSOCKET_PORT=6222

# NATS 数据目录 (Docker volume)
NATS_DATA_VOLUME=yii3-nats-data

# NATS JetStream Stream 名称
NATS_STREAM_NAME=yii3-stream

# NATS JetStream Consumer 名称
NATS_CONSUMER_NAME=yii3-consumer

# 是否启用 NATS 认证
NATS_ENABLE_AUTH=false

# NATS 用户名 (仅当 ENABLE_AUTH=true 时需要)
NATS_USER=

# NATS 密码 (仅当 ENABLE_AUTH=true 时需要)
NATS_PASSWORD=

# NATS 最大负载大小 (字节)
NATS_MAX_PAYLOAD=1048576

# NATS 最大连接数
NATS_MAX_CONNECTIONS=65536

# ============================================================
# Docker 资源限制配置
# ============================================================
# Yii3 应用容器资源限制
APP_MEMORY_LIMIT=512m
APP_CPU_LIMIT=1.0
APP_MEMORY_RESERVATION=256m
APP_CPU_RESERVATION=0.5

# PostgreSQL 容器资源限制
POSTGRES_MEMORY_LIMIT=1g
POSTGRES_CPU_LIMIT=1.0
POSTGRES_MEMORY_RESERVATION=512m
POSTGRES_CPU_RESERVATION=0.5

# Redis 容器资源限制
REDIS_MEMORY_LIMIT=512m
REDIS_CPU_LIMIT=0.5
REDIS_MEMORY_RESERVATION=256m
REDIS_CPU_RESERVATION=0.25

# MinIO 容器资源限制
MINIO_MEMORY_LIMIT=1g
MINIO_CPU_LIMIT=1.0
MINIO_MEMORY_RESERVATION=512m
MINIO_CPU_RESERVATION=0.5

# NATS 容器资源限制
NATS_MEMORY_LIMIT=512m
NATS_CPU_LIMIT=0.5
NATS_MEMORY_RESERVATION=256m
NATS_CPU_RESERVATION=0.25

# ============================================================
# 网络配置
# ============================================================
# Docker 网络名称
NETWORK_NAME=yii3-network

# 网络驱动: bridge, overlay, macvlan, none
NETWORK_DRIVER=bridge

# 网络子网 (可选)
# NETWORK_SUBNET=172.20.0.0/16

# ============================================================
# 健康检查配置
# ============================================================
# 健康检查间隔 (秒)
HEALTHCHECK_INTERVAL=30

# 健康检查超时 (秒)
HEALTHCHECK_TIMEOUT=10

# 健康检查重试次数
HEALTHCHECK_RETRIES=3

# 健康检查开始延迟 (秒)
HEALTHCHECK_START_PERIOD=10

# ============================================================
# 时区和地区配置
# ============================================================
# 容器时区
TZ=Asia/Shanghai

# 容器语言环境
LANG=en_US.UTF-8
LC_ALL=en_US.UTF-8
